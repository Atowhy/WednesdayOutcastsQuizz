<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Which Outcast Species Are You?</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="stylesheet" href="fonts.css">
    <style>
        body {
            /* Apply Typewriter Condensed as the base font */
            font-family: 'Typewriter Condensed', 'Inter', sans-serif;
            overflow-x: hidden;
            /* Prevent horizontal scrollbars caused by video */
            overflow-y: auto;
            /* Allow vertical scrolling when content overflows */
            font-size: 1.15rem;
            /* Increased base font size by 15% */
            line-height: 1.5;
            /* Adjust line height for readability */
        }

        .font-quotex {
            /* Apply Quotex font */
            font-family: 'Quotex', 'Spectral', serif;
        }

        .font-nocturne {
            /* Apply Nocturne Serif font */
            font-family: 'Nocturne Serif', 'Spectral', serif;
        }

        /* === UPDATED VIDEO STYLES === */

        /* Video Background Styles */
        #background-video {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            /* Ensures video covers the screen, maintaining aspect ratio */
            z-index: -100;
            /* Place it behind everything */
            filter: brightness(0.4);
            /* Darken the video slightly */
        }

        /* Reveal Video Styles */
        #reveal-video {
            display: none;
            /* Hidden by default */
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            /* Ensures video covers the screen, maintaining aspect ratio */
            z-index: -50;
            /* Above background, below content */
            mix-blend-mode: color-dodge;
            /* Apply color dodge */
        }

        /* === END UPDATED STYLES === */


        /* Custom scrollbar for a more gothic feel */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #1a202c;
        }

        ::-webkit-scrollbar-thumb {
            background: #4a5568;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #718096;
        }

        .question-card,
        .result-card,
        .tie-card {
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            background-color: rgba(31, 41, 55, 0.7);
            /* Adjust alpha for better readability over video */
        }

        /* Animations */

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        .animate-fade-in {
            animation: fadeIn 0.8s ease-out forwards;
        }

        /* Simplified slow fade */
        @keyframes slowFadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        .animate-slow-fade-in {
            animation: slowFadeIn 1.5s ease-out forwards;
        }

        @keyframes verySlowFadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        .animate-very-slow-fade-in {
            animation: verySlowFadeIn 2.5s ease-in forwards;
        }

        @keyframes slowFadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        .animate-slow-fade-in {
            animation: slowFadeIn 2s ease-in forwards;
        }

        /* Transition Animations */
        @keyframes fadeOut {
            from {
                opacity: 1;
                transform: translateY(0);
            }

            to {
                opacity: 0;
                transform: translateY(-10px);
            }
        }

        .animate-fade-out {
            animation: fadeOut 0.5s ease-out forwards;
        }

        /* Moon Loader Animation */
        .moon-loader {
            width: 120px;
            /* Increased size */
            height: 120px;
            /* Increased size */
            border-radius: 50%;
            background-color: #e5e7eb;
            /* Light grey moon */
            box-shadow: 0 0 25px rgba(255, 255, 255, 0.5);
            /* slightly increased glow */
            position: relative;
            overflow: hidden;
            margin: 0 auto 30px auto;
            /* adjusted margin */
        }

        .moon-loader::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #111827;
            /* Dark shadow matching bg */
            border-radius: 50%;
            animation: moonPhase 2s cubic-bezier(0.4, 0, 0.2, 1) infinite;
        }

        @keyframes moonPhase {
            0% {
                transform: translateX(100%);
            }

            50% {
                transform: translateX(0);
            }

            /* New Moon */
            100% {
                transform: translateX(-100%);
            }
        }

        @keyframes slowGlow {

            0%,
            100% {
                /* Using the light purple color for the glow */
                text-shadow: 0 0 10px rgba(164, 110, 219, 0.3), 0 0 15px rgba(164, 110, 219, 0.3);
            }

            50% {
                text-shadow: 0 0 20px rgba(164, 110, 219, 0.7), 0 0 30px rgba(164, 110, 219, 0.7);
            }
        }

        .animate-slow-glow {
            animation: slowGlow 4s ease-in-out infinite;
        }

        .animation-delay-300 {
            animation-delay: 300ms;
        }

        .animation-delay-600 {
            animation-delay: 600ms;
        }

        .animation-delay-1000 {
            animation-delay: 1000ms;
        }

        /* Custom styles for the new purple color */
        .bg-custom-purple {
            background-color: #5b108b;
        }

        .hover\:bg-custom-purple-dark:hover {
            background-color: #490d70;
        }

        /* Slightly darker shade for hover */
        .text-custom-purple-light {
            color: #a46edb;
        }

        /* Lighter shade for text */
        .text-custom-purple {
            color: #5b108b;
        }

        .text-custom-purple {
            color: #5b108b;
        }

        .decoration-custom-purple {
            text-decoration-color: #5b108b;
        }

        /* === NEW VISUAL ENHANCEMENTS === */

        /* Vignette Overlay */
        .vignette {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        /* Transition Effects */
        /* Transition Effects - REMOVED (Replaced by animations) */

        /* Typewriter Cursor (optional purely visual) */
        .typewriter-cursor::after {
            content: '|';
            animation: blink 1s step-start infinite;
        }

        @keyframes blink {
            50% {
                opacity: 0;
            }
        }

        /* === ROUND 2 ENHANCEMENTS === */

        /* --- NEW --- Poison Vial Progress Bar */
        .progress-container {
            width: 100%;
            height: 12px;
            /* Slightly taller for the 'vial' look */
            background: rgba(31, 41, 55, 0.9);
            /* Darker background for the empty glass */
            border-radius: 10px;
            /* Pill shape */
            margin-bottom: 2rem;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.5);
            /* Inner shadow for depth */
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #5b108b, #a46edb, #5b108b);
            background-size: 200% 100%;
            width: 0%;
            transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
            /* Smoother, slightly elastic transition */
            border-radius: 10px;
            position: relative;
            animation: potionFlow 3s linear infinite;
        }

        /* Bubbles inside the potion */
        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: radial-gradient(circle, rgba(255, 255, 255, 0.4) 1px, transparent 1px),
                radial-gradient(circle, rgba(255, 255, 255, 0.2) 2px, transparent 2px);
            background-size: 20px 20px, 15px 15px;
            background-position: 0 0, 10px 10px;
            animation: bubbling 2s linear infinite;
            opacity: 0.5;
            mix-blend-mode: overlay;
        }

        @keyframes potionFlow {
            0% {
                background-position: 100% 0;
            }

            100% {
                background-position: -100% 0;
            }
        }

        @keyframes bubbling {
            0% {
                background-position: 0 0, 10px 10px;
            }

            100% {
                background-position: -20px -20px, -5px -5px;
                /* Move up and left */
            }
        }

        /* Snarky Commentary Overlay Styles */
        @keyframes breatheVignette {

            0%,
            100% {
                background-color: rgba(10, 5, 20, 0.4);
            }

            50% {
                background-color: rgba(5, 2, 10, 0.85);
            }
        }

        #snarky-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(10, 5, 20, 0.4);
            box-shadow: inset 0 0 150px rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(8px) grayscale(50%);
            -webkit-backdrop-filter: blur(8px) grayscale(50%);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
            opacity: 0;
            pointer-events: none;
            transition: opacity 1.5s ease-in-out;
            /* Slower, more ghostly fade */
        }

        #snarky-overlay.show {
            opacity: 1;
            pointer-events: auto;
            animation: breatheVignette 4s ease-in-out infinite;
        }

        #snarky-commentary {
            font-family: 'Quotex', sans-serif;
            font-style: italic;
            font-size: 3.5rem;
            color: #e2e8f0;
            text-align: center;
            max-width: 80%;
            line-height: 1.2;
            text-shadow: 0 4px 15px rgba(0, 0, 0, 0.8), 0 0 20px rgba(164, 110, 219, 0.6);
        }

        /* Hover Glow Effect - INTENSIFIED */
        /* Hover Effect - Rebuilt */
        /* Hover Effect - Rebuilt & Simplified */
        .answer-btn {
            background-color: #374151;
            /* bg-gray-700 */
            transition: transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275), background-color 0.2s ease, box-shadow 0.2s ease;
            border: 1px solid transparent;
            cursor: pointer !important;
            position: relative;
            z-index: 20;
            /* Force above container */
        }

        .answer-btn:hover {
            background-color: #5b108b !important;
            /* Force Custom purple */
            transform: scale(1.03) !important;
            box-shadow: 0 0 20px rgba(164, 110, 219, 0.6) !important;
            border-color: #a46edb !important;
            z-index: 10;
        }

        /* --- NEW --- Active state for visual click feedback */
        .answer-btn.clicked {
            transform: scale(0.95) !important;
            box-shadow: 0 0 5px rgba(164, 110, 219, 0.8) !important;
            background-color: #490d70 !important;
            /* darker purple */
            transition: transform 0.1s ease, background-color 0.1s ease, box-shadow 0.1s ease;
        }

        /* --- NEW --- Active state for visual click feedback */
        .answer-btn:active,
        .answer-btn.clicked {
            transform: scale(0.95) !important;
            box-shadow: 0 0 5px rgba(164, 110, 219, 0.8) !important;
            background-color: #490d70 !important;
            /* darker purple */
            transition: transform 0.1s ease, background-color 0.1s ease, box-shadow 0.1s ease;
        }
    </style>
</head>

<body
    class="bg-gray-900 text-gray-200 min-h-screen flex items-center justify-center p-4 transition-all duration-500 overflow-hidden">

    <!-- Visual Enhancements -->
    <!-- Visual Enhancements -->

    <video autoplay loop muted playsinline id="background-video">
        <source src="BGQuizzWed.mp4" type="video/mp4">
        Your browser does not support the video tag.
    </video>

    <video id="reveal-video" muted playsinline>
    </video>

    <div id="quiz-container" class="w-full max-w-2xl mx-auto relative z-10">
        <div id="start-screen" class="text-center">
            <h1 class="font-quotex text-5xl md:text-6xl font-bold mb-4 text-white opacity-0 animate-fade-in">Which
                Nevermore Outcast Are You?</h1>
            <p class="text-xl text-gray-400 mb-10 opacity-0 animate-fade-in animation-delay-300 px-4">Your powers are
                a mirror of your inner self. Answer the questions to reveal the truth.</p>

            <button id="start-btn"
                class="bg-custom-purple hover:bg-custom-purple-dark text-white font-bold py-3 px-8 rounded-lg text-xl transition-transform transform hover:scale-105 shadow-lg opacity-0 animate-very-slow-fade-in animation-delay-1000">Begin
                the Diagnosis</button>
        </div>

        <div id="quiz-screen" class="hidden">
            <div id="question-card"
                class="question-card border border-gray-700 rounded-xl shadow-2xl p-6 md:p-8 relative">
                <!-- Progress Bar -->
                <div class="progress-container">
                    <div id="progress-fill" class="progress-fill"></div>
                </div>
                <p id="question-counter" class="text-base text-custom-purple-light mb-2 font-semibold"></p>
                <h2 id="question-text" class="text-3xl font-bold mb-6 text-white"></h2>

                <div id="answer-buttons" class="grid grid-cols-1 gap-4">
                </div>
            </div>
        </div>

        <!-- NEW: Snarky Overlay -->
        <div id="snarky-overlay">
            <p id="snarky-commentary" class="font-quotex text-white shadow-lg"></p>
        </div>

        <div id="tie-screen" class="hidden">
            <div class="tie-card border border-gray-700 rounded-xl shadow-2xl p-6 md:p-8 text-center">
                <h2 class="font-quotex text-4xl md:text-5xl font-bold mb-4 text-white">Your Affinity is Split</h2>
                <p class="text-xl text-gray-400 mb-8">Your answers point to multiple paths. Choose the one that calls to
                    you.</p>
                <div id="tie-buttons" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                </div>
            </div>
        </div>

        <!-- Moon Loader Screen -->
        <div id="loader-screen" class="hidden absolute inset-0 flex items-center justify-center z-50">
            <div class="text-center">
                <div class="moon-loader"></div>
                <p class="font-quotex text-2xl text-white animate-pulse">Consulting visions...</p>
            </div>
        </div>

        <div id="result-screen" class="hidden opacity-0">
            <div class="result-card border border-gray-700 rounded-xl shadow-2xl p-6 md:p-8 text-center">
                <p class="text-custom-purple-light font-semibold mb-2 text-lg">Your Outcast Profile:</p>
                <h2 id="result-title" class="font-quotex text-5xl md:text-6xl font-bold mb-4 text-white"></h2>
                <div id="result-icon" class="text-7xl my-6"></div>
                <p id="result-description" class="text-gray-300 text-lg md:text-xl mb-8 leading-relaxed"></p>

                <div id="sub-result-container" class="mt-8 border-t border-gray-700 pt-8">
                    <p class="text-custom-purple-light font-semibold mb-2 text-lg">Your Secondary Affinity:</p>
                    <h3 id="sub-result-title" class="font-nocturne text-3xl font-bold text-white"></h3>
                </div>

                <div class="my-10">
                    <h3 class="text-2xl font-semibold text-custom-purple-light mb-4">Your Affinity Analysis</h3>
                    <div class="w-full mx-auto h-72 md:h-96 flex justify-center items-center"> <canvas
                            id="result-chart"></canvas>
                    </div>
                </div>
                <button id="restart-btn"
                    class="bg-gray-600 hover:bg-gray-700 text-white font-bold py-3 px-8 rounded-lg text-xl transition-transform transform hover:scale-105 shadow-lg">Try
                    Again</button>
            </div>
        </div>
    </div>

    </div>

    <div id="tooltip"
        class="hidden absolute bg-gray-800 text-white text-base rounded-lg p-3 max-w-xs z-50 pointer-events-none shadow-lg leading-relaxed">
    </div>
    <script>
        const startBtn = document.getElementById('start-btn');
        const restartBtn = document.getElementById('restart-btn');
        const startScreen = document.getElementById('start-screen');
        const quizScreen = document.getElementById('quiz-screen');
        const tieScreen = document.getElementById('tie-screen');
        const resultScreen = document.getElementById('result-screen');

        const questionCounterEl = document.getElementById('question-counter');
        const questionTextEl = document.getElementById('question-text');
        const snarkyCommentaryEl = document.getElementById('snarky-commentary');
        const answerButtonsEl = document.getElementById('answer-buttons');

        const resultTitleEl = document.getElementById('result-title');
        const resultIconEl = document.getElementById('result-icon');
        const resultDescriptionEl = document.getElementById('result-description');
        const subResultContainer = document.getElementById('sub-result-container');
        const subResultTitleEl = document.getElementById('sub-result-title');
        const resultChartEl = document.getElementById('result-chart');
        const tooltip = document.getElementById('tooltip');

        // --- NEW --- Round 2 Elements
        const quizContainer = document.getElementById('quiz-container');
        const progressFill = document.getElementById('progress-fill');
        const loaderScreen = document.getElementById('loader-screen');

        // --- NEW --- Typewriter Effect
        let typewriterTimeout; // Global variable to store timeout ID

        function typeWriter(element, text, speed = 30) {
            // Clear any existing typewriter animation for this element
            if (typewriterTimeout) clearTimeout(typewriterTimeout);

            element.innerHTML = "";
            let i = 0;
            function type() {
                if (i < text.length) {
                    element.innerHTML += text.charAt(i);
                    i++;
                    typewriterTimeout = setTimeout(type, speed);
                } else {
                    element.classList.remove('typewriter-cursor'); // Remove cursor when done
                }
            }
            element.classList.add('typewriter-cursor');
            type();
        }

        // Video elements
        const backgroundVideo = document.getElementById('background-video');
        const revealVideo = document.getElementById('reveal-video');

        let currentQuestionIndex = 0;
        let scores = {};
        let resultChart = null;
        let snarkyCount = 0; // NEW: Track how many snarky comments have been shown

        const newPurpleColor = '#5b108b';
        const newPurpleHoverColor = '#490d70'; // Slightly darker for hover
        const newPurpleLightColor = '#a46edb'; // Lighter shade for text/accents

        // --- NEW --- Snarky Comments Bank
        const snarkyComments = [
            "Are you trying to be mundane, or does it come naturally?",
            "Your choices are... adequately disappointing.",
            "I've seen corpses make faster decisions.",
            "Fascinating. In a purely clinical sense, of course.",
            "Please tell me you're not actually this predictable.",
            "At this point, rolling dice might be more effective."
        ];

        const questions = [
            {
                question: "What is your deepest feeling about the future?",
                answers: [
                    { text: "A grim, inevitable outcome.", species: "Raven" },
                    { text: "A bright possibility. There's always hope.", species: "Dove" },
                    { text: "A chaotic series of events that I can only navigate with my friends.", species: "Werewolf" },
                    { text: "An opportunity to shift events in my favor.", species: "Siren" },
                    { text: "A glimpse of a brilliant new invention from my equally brilliant mind.", species: "DaVinci" }
                ]
            },
            {
                question: "How do you handle social gatherings?",
                answers: [
                    { text: "I find a quiet corner and observe everyone's behavior.", species: "Shapeshifter" },
                    { text: "I stick to my small, trusted group.", species: "Werewolf" },
                    { text: "I avoid eye contact.", species: "Gorgon" },
                    { text: "I prefer to stay home. People are exhausting.", species: "Vampire" },
                    { text: "I feel a restless energy that urges me to escape.", species: "Alpha" }
                ]
            },
            {
                question: "Someone has deeply betrayed you. Your first instinct is to:",
                answers: [
                    { text: "Retreat and analyze.", species: "Raven" },
                    { text: "I feel an overwhelming, almost frightening surge of raw emotion.", species: "Hyde" },
                    { text: "I go to my friends.", species: "Werewolf" },
                    { text: "Make them regret it by undermining them.", species: "Siren" },
                    { text: "Offer forgiveness.", species: "Dove" }
                ]
            },
            {
                question: "Your ideal weekend is spent:",
                answers: [
                    { text: "Planning or executing a long-term project.", species: "Vampire" },
                    { text: "Designing my next intricate project.", species: "DaVinci" },
                    { text: "Hanging out with friends.", species: "Werewolf" },
                    { text: "Having a massive party!", species: "Swarmer" },
                    { text: "Thrift shopping.", species: "Shapeshifter" }
                ]
            },
            {
                question: "How do you get what you want?",
                answers: [
                    { text: "I find leverage.", species: "Vampire" },
                    { text: "I mobilize my network and make it a common cause.", species: "Swarmer" },
                    { text: "I just go in with pure confidence and willpower.", species: "Alpha" },
                    { text: "I wait patiently for the right, peaceful opportunity.", species: "Dove" },
                    { text: "I persuade or provoke, depends on the situation.", species: "Siren" }
                ]
            },
            {
                question: "You need to intimidate a rival. You:",
                answers: [
                    { text: "Use their fear against them.", species: "Vampire" },
                    { text: "Let them know you have eyes and ears everywhere.", species: "Swarmer" },
                    { text: "Stare at them.", species: "Gorgon" },
                    { text: "Challenge them in a battle of wits.", species: "DaVinci" },
                    { text: "Pop my biceps out.", species: "Alpha" }
                ]
            },
            {
                question: "The greatest risk you can take is:",
                answers: [
                    { text: "Fully committing to a confrontation where I am outmatched.", species: "Alpha" },
                    { text: "Offering forgiveness to someone who will certainly betray that trust.", species: "Dove" },
                    { text: "Allowing me to lose my selfcontrol.", species: "Hyde" },
                    { text: "Letting someone see my true self.", species: "Gorgon" },
                    { text: "Dressing wrong for the part.", species: "Shapeshifter" }
                ]
            },
            {
                question: "Which concept are you most fascinated by?",
                answers: [
                    { text: "The design of a complex machine.", species: "DaVinci" },
                    { text: "The power of a single voice to command a room.", species: "Siren" },
                    { text: "The elegance of ancient history and the secrets it holds.", species: "Vampire" },
                    { text: "The overwhelming power of a collective.", species: "Swarmer" },
                    { text: "The raw, painful truths hidden in dark poetry.", species: "Raven" }
                ]
            },
            {
                question: "When you feel pressure to conform, how do you handle it?",
                answers: [
                    { text: "I blend in perfectly.", species: "Shapeshifter" },
                    { text: "I simply refuse. I'd rather face the consequences than compromise my nature.", species: "Gorgon" },
                    { text: "I outwardly conform but quietly undermine the whole effort.", species: "Raven" },
                    { text: "I look for a cathartic outlet for the building pressure.", species: "Hyde" },
                    { text: "I make them believe they need to conform to me.", species: "Siren" }
                ]
            },
            {
                question: "How do you typically react when injustice is inflicted on someone weaker?",
                answers: [
                    { text: "I intervene immediately.", species: "Alpha" },
                    { text: "I shame the aggressor publicly.", species: "Siren" },
                    { text: "I search for a non-violent solution that teaches a lesson.", species: "DaVinci" },
                    { text: "I immediately rush to the victim's side.", species: "Werewolf" },
                    { text: "I alert everyone I know. This kind of injustice requires a public confrontation.", species: "Swarmer" }
                ]
            },
            {
                question: "Your greatest fear is:",
                answers: [
                    { text: "Being completely isolated.", species: "Werewolf" },
                    { text: "Losing my influence over others.", species: "Vampire" },
                    { text: "Losing my temper.", species: "Hyde" },
                    { text: "Being intellectually outmatched.", species: "DaVinci" },
                    { text: "That my true self might be rejected.", species: "Shapeshifter" }
                ]
            },
            {
                question: "Your primary defense mechanism is:",
                answers: [
                    { text: "Complete emotional withdrawal.", species: "Raven" },
                    { text: "To avoid intense confrontation.", species: "Gorgon" },
                    { text: "Disarming them with overwhelming kindness.", species: "Dove" },
                    { text: "My strength.", species: "Alpha" },
                    { text: "My group of friends.", species: "Werewolf" }
                ]
            },
            {
                question: "Your preferred method of communication is:",
                answers: [
                    { text: "Direct and blunt.", species: "Raven" },
                    { text: "Persuasive and tailored to the audience.", species: "Siren" },
                    { text: "Non-verbal. A single look says it all.", species: "Gorgon" },
                    { text: "Adapting my style to perfectly match who I'm talking to.", species: "Shapeshifter" },
                    { text: "Calming and inspirational.", species: "Dove" }
                ]
            },
            {
                question: "You find an old, forgotten diary. You:",
                answers: [
                    { text: "I'm drawn to it, hoping to perceive the residue of the owner's strongest emotions.", species: "Raven" },
                    { text: "Read it. Knowledge is power.", species: "Vampire" },
                    { text: "Leave it. Some secrets are best left buried.", species: "Gorgon" },
                    { text: "See it as a puzzle, a complex system of thoughts to decode.", species: "DaVinci" },
                    { text: "Hope it contains a story of redemption and hope.", species: "Dove" }
                ]
            },
            {
                question: "A friend is in danger. You:",
                answers: [
                    { text: "I take charge and confront the threat head-on.", species: "Alpha" },
                    { text: "I call my other friends.", species: "Werewolf" },
                    { text: "I might become violent.", species: "Hyde" },
                    { text: "I create a diversion.", species: "Swarmer" },
                    { text: "I help them talk their way out of it.", species: "Siren" }
                ]
            },
            {
                question: "Your personal philosophy can be summed up as:",
                answers: [
                    { text: "Hope is a guiding light, and kindness is strength.", species: "Dove" },
                    { text: "Knowledge is the only true currency.", species: "Vampire" },
                    { text: "Always let them see who they want to see.", species: "Shapeshifter" },
                    { text: "Raw instinct is the only real truth.", species: "Hyde" },
                    { text: "Power isn't given; it's taken.", species: "Alpha" }
                ]
            }
        ];

        const results = {
            Raven: {
                title: "Raven Psychic",
                icon: "ðŸ¦â€â¬›",
                description: "You see the world for what it is: a landscape of dark truths and grim possibilities. Your visions are potent and often violent, a reflection of your cynical worldview. This gift is a heavy burden, isolating you and threatening your sanity without proper control. You walk a lonely path, guided by ancient spirits, your personality both the cause and consequence of your powerful, dark gift."
            },
            Dove: {
                title: "Dove Psychic",
                icon: "ðŸ•Šï¸",
                description: "You are a vessel for lighter, more hopeful visions. Your power stems from an optimistic worldview, filtering your psychic perceptions toward positive outcomes. While your abilities may not be as raw or violent as a Raven's, you possess a formidable gift for seeing the good. You understand that psychic power is a mirror of the self, and yours reflects hope."
            },
            Werewolf: {
                title: "Werewolf",
                icon: "ðŸº",
                description: "Loyalty, pack, and social pressure define your existence. Your power is tied to the moon and, more importantly, to your emotions. You feel a deep need to belong and protect your own. Whether you're a 'late bloomer' or the heart of the pack, your strength truly awakens not by celestial cycles, but by your fierce devotion to those you call family."
            },
            Siren: {
                title: "Siren",
                icon: "ðŸŽ¶",
                description: "You are a natural leader, possessing a power of persuasion that makes you socially dominant and influential. Your 'siren song' can sway emotions and compel action, placing you at the top of any hierarchy. However, this gift is a cage; it breeds distrust and makes genuine connection difficult. You constantly negotiate between your true self and the powerful manipulator others fear you to be."
            },
            Gorgon: {
                title: "Gorgon",
                icon: "ðŸ",
                description: "Your power is a constant hazard, forcing you into a life of caution and withdrawal. You've adopted a laid-back, non-confrontational persona as a necessary coping mechanism. Taught from a young age to avoid engagement, your social identity is a direct adaptation to your biology. You know that a single glanceâ€”either at others or at yourselfâ€”can be lethal."
            },
            Vampire: {
                title: "Vampire",
                icon: "ðŸ¦‡",
                description: "You are an aloof and enigmatic soul with an air of gothic aristocracy. Rooted in ancient tradition, you prefer the shadows to the spotlight. You are photosensitive but not destroyed by the sun, moving through the world on your own terms and on your own time. You keep to yourself, an understated but permanent fixture in any social ecosystem, content in your longevity."
            },
            Hyde: {
                title: "Hyde",
                icon: "ðŸ§ª",
                description: "You harbor a monstrous, primal alter ego, born of mutation and trauma. This dormant side can be unlocked by an external force, leaving you psychologically bound to a 'master' or a past event. You possess terrifying physical power, but it's a weapon forged from your own pain and rage. You walk the tragic line between victim and perpetrator, your greatest battle being with the monster within."
            },
            Shapeshifter: {
                title: "Shapeshifter",
                icon: "ðŸŽ­",
                description: "You are a master of adaptation and observation. Your power allows you to assume the form of anyone, a perfect mimicry of voice, appearance, and clothing. This makes you invaluable for espionage and secrecy, but it can leave you with a fragile sense of your own core identity. You are most comfortable when you are someone else, a mystery even to yourself."
            },
            Swarmer: {
                title: "Swarmer / Avian",
                icon: "ðŸ",
                description: "You have a unique connection to the natural world, able to mentally communicate with and command legions of creatures others ignore. Your power is contingent on your environment, making you seem unassuming in one place and overwhelmingly powerful in another. You often prefer the company of your non-human allies to people, wielding a subtle but formidable influence over the world."
            },
            DaVinci: {
                title: "DaVinci",
                icon: "âœï¸",
                description: "You are a fascinating blend of telekinesis and artistic genius. You move the world with your mind, but this ability is intrinsically linked to your heightened creativity and intellect. You are an inventor, a creator, a 'mad genius'. This profound power comes with a great risk: the potential for it to overwhelm your psyche and drive you to insanity. Your mind is both your greatest tool and your most fragile asset."
            },
            Alpha: {
                title: "Alpha Werewolf",
                icon: "ðŸŒ•",
                description: "You are a rare and powerful anomaly. Your werewolf abilities are greatly enhanced, and you are liberated from the lunar cycle, able to transform at will. But this power is a terrifying curse. You are feared as a 'loose cannon' by your own kind, and a single transformation under the full moon could trap you in wolf form forever, making you an outlaw to be hunted by your former pack."
            }
        };

        /* --- NEW --- Utility function to shuffle an array (Fisher-Yates) */
        function shuffleArray(array) {
            let newArray = [...array]; // Create a copy
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]]; // ES6 swap
            }
            return newArray;
        }

        function startQuiz() {
            currentQuestionIndex = 0;
            snarkyCount = 0; // Reset snarky count
            scores = { Raven: 0, Dove: 0, Werewolf: 0, Siren: 0, Gorgon: 0, Vampire: 0, Hyde: 0, Shapeshifter: 0, Swarmer: 0, DaVinci: 0, Alpha: 0 };
            startScreen.classList.add('hidden');
            tieScreen.classList.add('hidden');

            resultScreen.classList.add('hidden');
            resultScreen.classList.remove('animate-slow-fade-in');
            resultScreen.classList.add('opacity-0');

            resultTitleEl.classList.remove('animate-slow-glow');

            quizScreen.classList.remove('hidden');
            if (resultChart) {
                resultChart.destroy();
            }

            // Hide reveal video on restart
            revealVideo.style.display = 'none';
            revealVideo.pause();
            revealVideo.currentTime = 0;

            showQuestion();
        }

        function showQuestion() {
            if (currentQuestionIndex > 0) {
                const card = document.getElementById('question-card');
                card.classList.remove('animate-fade-in'); // Reset in case it's there
                card.classList.add('animate-fade-out');

                setTimeout(() => {
                    updateQuestionContent();
                    card.classList.remove('animate-fade-out');
                    // Force opacity to 0 via class before adding fade-in to preventing snapping? 
                    // The animate-fade-in starts at 0, so it should be fine.
                    card.classList.add('animate-fade-in');
                }, 500); // Wait for fade out
            } else {
                updateQuestionContent();
            }
        }

        function updateQuestionContent() {
            resetState();
            const question = questions[currentQuestionIndex];
            questionCounterEl.innerText = `Question ${currentQuestionIndex + 1} / ${questions.length}`;

            // --- NEW --- Update Progress Bar
            const progress = ((currentQuestionIndex) / questions.length) * 100;
            progressFill.style.width = `${progress}%`;

            // Apply typewriter effect to question text
            typeWriter(questionTextEl, question.question);

            // --- UPDATED --- Create a shuffled copy of the answers
            const shuffledAnswers = shuffleArray(question.answers);

            // --- UPDATED --- Loop over the shuffled answers
            shuffledAnswers.forEach((answer, index) => {
                const button = document.createElement('button');
                button.innerText = answer.text;
                // Use new classes - ANIMATION RESTORED
                button.className = "answer-btn w-full text-white font-semibold py-4 px-6 rounded-lg text-left text-lg shadow-md opacity-0 animate-fade-in";

                // Add stagger delay
                button.style.animationDelay = `${(index + 1) * 150 + 300}ms`;

                button.addEventListener('click', function () { selectAnswer(answer.species, this); });
                answerButtonsEl.appendChild(button);
            });
        }

        const snarkyOverlayEl = document.getElementById('snarky-overlay');

        function resetState() {
            while (answerButtonsEl.firstChild) {
                answerButtonsEl.removeChild(answerButtonsEl.firstChild);
            }
        }

        function selectAnswer(species, buttonElement) {
            scores[species]++;

            // --- NEW --- Visual Click Feedback
            buttonElement.classList.add('clicked');

            // Disable all buttons to prevent multiple clicks
            const buttons = answerButtonsEl.querySelectorAll('.answer-btn');
            buttons.forEach(btn => btn.style.pointerEvents = 'none');

            // Visually select the clicked button permanently
            setTimeout(() => {
                buttonElement.classList.remove('hover:bg-custom-purple-dark', 'hover:scale-105', 'clicked');
                buttonElement.classList.add('bg-custom-purple', 'border-a46edb', 'shadow-[0_0_20px_rgba(164,110,219,0.6)]', 'scale-105');
                buttonElement.style.transform = 'scale(1.03)';
                buttonElement.style.boxShadow = '0 0 20px rgba(164, 110, 219, 0.6)';

                // Hide the comment initially if it was showing
                snarkyOverlayEl.classList.remove('show');
                snarkyCommentaryEl.innerHTML = "";

                // Decide if we pop a snarky comment (Max 3 times)
                if (currentQuestionIndex > 0 && Math.random() < 0.35 && snarkyCount < 3) {
                    snarkyCount++;
                    setTimeout(() => {
                        const randomComment = snarkyComments[Math.floor(Math.random() * snarkyComments.length)];
                        snarkyOverlayEl.classList.add('show');

                        // Start typing slightly after the fade starts
                        setTimeout(() => {
                            typeWriter(snarkyCommentaryEl, randomComment, 40);
                        }, 150);
                    }, 300);

                    // Delay next question to allow reading
                    setTimeout(() => {
                        snarkyOverlayEl.classList.remove('show');
                        setTimeout(() => {
                            proceedToNextQuestion();
                        }, 1500); // Slower fade out duration (matches CSS transition 1.5s)
                    }, 4000); // Increased delay due to typing time
                } else {
                    // Short delay just for button feedback
                    setTimeout(() => {
                        proceedToNextQuestion();
                    }, 250); // Reduced delay for snappier transition
                }
            }, 150); // Small delay to let the click animation finish
        }

        function proceedToNextQuestion() {
            currentQuestionIndex++;
            if (currentQuestionIndex < questions.length) {
                showQuestion();
            } else {
                // --- NEW --- Show Loader before Result
                quizScreen.classList.add('hidden');
                loaderScreen.classList.remove('hidden');
                setTimeout(() => {
                    loaderScreen.classList.add('hidden');
                    showResult();
                }, 2500); // 2.5s loading time
            }
        }

        function showResult() {
            const scoresArray = Object.entries(scores).sort((a, b) => b[1] - a[1]);
            const maxScore = scoresArray[0][1];
            const tiedWinners = scoresArray.filter(item => item[1] === maxScore);

            if (tiedWinners.length > 1) {
                showTieScreen(tiedWinners, scoresArray);
            } else {
                const winnerSpecies = scoresArray[0][0];
                displayFinalResult(winnerSpecies, scoresArray);
            }
        }

        function showTieScreen(tiedWinners, scoresArray) {
            const tieButtonsEl = document.getElementById('tie-buttons');
            tieButtonsEl.innerHTML = '';

            tiedWinners.forEach(winner => {
                const speciesKey = winner[0];
                const resultData = results[speciesKey];
                const button = document.createElement('button');
                // Updated hover color, increased font size
                button.classList.add('bg-gray-700', 'hover:bg-custom-purple', 'text-white', 'font-semibold', 'py-4', 'px-4', 'rounded-lg', 'text-center', 'transition-all', 'duration-200', 'transform', 'hover:scale-105', 'text-lg');

                button.innerHTML = `
                    <div class="text-5xl mb-2">${resultData.icon}</div>
                    <div class="font-quotex text-2xl">${resultData.title}</div>
                `;

                button.addEventListener('click', () => {
                    displayFinalResult(speciesKey, scoresArray);
                });
                tieButtonsEl.appendChild(button);
            });

            quizScreen.classList.add('hidden');
            resultScreen.classList.add('hidden');
            tieScreen.classList.remove('hidden');
        }

        function displayFinalResult(chosenSpecies, scoresArray) {
            // --- Play Reveal Video ---
            try {
                revealVideo.src = 'BGRevealQuizzWed.mp4';
                revealVideo.style.display = 'block';
                revealVideo.play().catch(error => {
                    console.error("Reveal video play failed:", error);
                    // Hide it if it fails to play
                    revealVideo.style.display = 'none';
                });
            } catch (e) {
                console.error("Error setting up reveal video:", e);
                revealVideo.style.display = 'none';
            }
            // --- End Reveal Video ---

            const resultData = results[chosenSpecies];
            resultTitleEl.innerText = resultData.title;
            resultTitleEl.classList.add('animate-slow-glow');

            resultIconEl.innerText = resultData.icon;
            resultDescriptionEl.innerText = resultData.description;

            // --- REVISED LOGIC FOR SUB-AFFINITY ---
            const maxScore = scoresArray[0][1];
            const allWinners = scoresArray.filter(item => item[1] === maxScore);

            const unchosenWinners = allWinners.filter(item => item[0] !== chosenSpecies);
            const remainingScores = scoresArray.filter(item => item[1] < maxScore);

            let secondaryAffinities = [];
            if (unchosenWinners.length > 0) {
                secondaryAffinities = unchosenWinners;
            } else if (remainingScores.length > 0) {
                const secondPlaceScore = remainingScores[0][1];
                secondaryAffinities = remainingScores.filter(item => item[1] === secondPlaceScore);
            }

            subResultTitleEl.innerHTML = '';

            const finalSecondary = secondaryAffinities.filter(item => item[1] >= 3);

            if (finalSecondary.length > 0) {
                finalSecondary.forEach((sub, index) => {
                    const subSpeciesKey = sub[0];
                    const subResultData = results[subSpeciesKey];

                    const span = document.createElement('span');
                    span.innerText = subResultData.title;
                    span.style.cursor = 'help';
                    // Updated decoration color
                    span.classList.add('underline', 'decoration-dotted', 'decoration-custom-purple');

                    span.addEventListener('mousemove', (e) => {
                        tooltip.innerHTML = subResultData.description;
                        tooltip.style.left = `${e.pageX + 15}px`;
                        tooltip.style.top = `${e.pageY + 15}px`;
                        tooltip.classList.remove('hidden');
                    });
                    span.addEventListener('mouseout', () => {
                        tooltip.classList.add('hidden');
                    });

                    subResultTitleEl.appendChild(span);

                    if (index < finalSecondary.length - 1) {
                        subResultTitleEl.appendChild(document.createTextNode(', '));
                    }
                });

                const subResultLabel = subResultContainer.querySelector('p');
                subResultLabel.innerText = finalSecondary.length > 1 ? 'Your Secondary Affinities:' : 'Your Secondary Affinity:';

                subResultContainer.classList.remove('hidden');
            } else {
                subResultContainer.classList.add('hidden');
            }

            quizScreen.classList.add('hidden');
            tieScreen.classList.add('hidden');

            resultScreen.classList.remove('hidden');
            // Trigger Fade In
            setTimeout(() => {
                resultScreen.classList.remove('opacity-0');
                resultScreen.classList.add('animate-slow-fade-in-up');
            }, 100);

            createRadarChart();
        }

        function createRadarChart() {
            // Apply Typewriter Condensed to chart labels, increase size
            Chart.defaults.font.family = "'Typewriter Condensed', 'Inter', sans-serif";
            Chart.defaults.font.size = 14; // Increased default font size slightly
            const chartLabels = Object.keys(scores).map(species => results[species].title);

            function wrapText(text, maxWidth) {
                const words = text.split(' ');
                let lines = [];
                let currentLine = words[0];

                for (let i = 1; i < words.length; i++) {
                    const word = words[i];
                    if (currentLine.length + word.length + 1 < maxWidth) {
                        currentLine += ' ' + word;
                    } else {
                        lines.push(currentLine);
                        currentLine = word;
                    }
                }
                lines.push(currentLine);
                return lines;
            }

            const chartData = {
                labels: chartLabels,
                datasets: [{
                    label: 'Your Species Affinity',
                    data: Object.values(scores),
                    // Updated chart colors
                    backgroundColor: 'rgba(91, 16, 139, 0.2)', // New purple with alpha
                    borderColor: newPurpleColor,
                    borderWidth: 2,
                    pointBackgroundColor: newPurpleColor,
                    pointBorderColor: '#fff',
                    pointHoverBackgroundColor: '#fff',
                    pointHoverBorderColor: newPurpleColor
                }]
            };

            const chartConfig = {
                type: 'radar',
                data: chartData,
                options: {
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            min: -1,
                            angleLines: {
                                color: 'rgba(255, 255, 255, 0.2)'
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.2)'
                            },
                            pointLabels: {
                                color: '#e2e8f0',
                                font: {
                                    size: 14 // Increased point label size
                                }
                            },
                            ticks: {
                                color: '#94a3b8',
                                backdropColor: 'rgba(0,0,0,0.5)',
                                stepSize: 1,
                                callback: function (value, index, values) {
                                    if (value === -1) return ''; // Hide -1 labeld
                                    return value;
                                },
                                font: {
                                    size: 12 // Adjusted tick label size if needed
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            enabled: true,
                            backgroundColor: 'rgba(31, 41, 55, 0.9)',
                            // Apply custom fonts to tooltips, increased size
                            titleFont: { size: 16, family: "'Quotex', 'Spectral', serif" },
                            bodyFont: { size: 14, family: "'Typewriter Condensed', 'Inter', sans-serif" },
                            padding: 10,
                            cornerRadius: 4,
                            callbacks: {
                                label: () => '',
                                afterBody: function (context) {
                                    const speciesKey = Object.keys(scores)[context[0].dataIndex];
                                    const description = results[speciesKey].description;
                                    return wrapText(description, 40);
                                }
                            }
                        }
                    }
                }
            };

            resultChart = new Chart(resultChartEl, chartConfig);
        }

        startBtn.addEventListener('click', startQuiz);
        restartBtn.addEventListener('click', startQuiz);

        // Add event listener for when the reveal video finishes
        revealVideo.addEventListener('ended', () => {
            revealVideo.style.display = 'none'; // Hide it
            revealVideo.src = ''; // Clear source to free up memory
        });

    </script>
</body>

</html>